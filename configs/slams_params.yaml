slam_toolbox:
  ros__parameters:
    # General Settings
    use_sim_time: true          # Set to true if using Gazebo or other simulation with /clock
    mode: "mapping"             # Use "localization" to run on a pre-built map
    use_map_saver: true         # Enable the map saving service
    debug_logging: false        # Keep false for cleaner output unless debugging

    # Frame Configuration (Verify these match your TF tree)
    odom_frame: "odom"          # Frame ID for odometry
    map_frame: "map"            # Frame ID for the map generated by SLAM
    base_frame: "base_link"     # Frame ID for the robot's base
    scan_topic: "/scan"         # Topic receiving LaserScan messages (output of pointcloud_to_laserscan)

    # Processing Control
    throttle_scans: 1           # Process every 1 scan (adjust to 2, 3... if CPU load is high)

    # Timing Parameters
    transform_timeout: 0.5      # Max wait time for TF transforms (seconds)
    tf_buffer_duration: 30.0    # TF buffer length (seconds)

    # Map Parameters
    resolution: 0.05            # Map resolution (meters per pixel)
    # **** CRITICAL **** Occupancy threshold (probability > this = occupied)
    occupancy_threshold: 0.65   # Standard value, less sensitive to noise than 0.1

    # Sensor Range Parameters (Must match the data on /scan)
    min_laser_range: 0.2        # Minimum valid laser range (meters)
    # **** CRITICAL **** Adjusted for 30m sensor/scan range
    max_laser_range: 12.0       # Maximum valid laser range (meters)

    # Update Trigger Thresholds (Adjusted for more frequent updates)
    minimum_travel_distance: 0.15 # Min distance traveled before updating graph (meters)
    minimum_travel_heading: 0.15  # Min angle turned before updating graph (radians, ~8.6 deg)

    # Scan Buffer Settings
    scan_buffer_size: 10          # Number of scans stored for matching
    scan_buffer_maximum_scan_distance: 10.0 # Max distance between buffered scans for matching

    # Scan Matching Parameters (Defaults/User-provided are often good starting points)
    link_match_minimum_response_fine: 0.2
    link_scan_maximum_distance: 1.5
    correlation_search_space_dimension: 0.5
    correlation_search_space_resolution: 0.01
    correlation_search_space_smear_deviation: 0.1
    distance_variance_penalty: 0.5
    angle_variance_penalty: 1.0

    # Loop Closure Parameters
    do_loop_closing: true               # Enable loop closure detection
    link_match_minimum_response_fine: 0.25
    loop_search_maximum_distance: 3.0   # Max distance to search for loop closures
    loop_match_minimum_chain_size: 10   # Min number of linked nodes for loop closure
    loop_match_maximum_variance_coarse: 2.0
    loop_match_minimum_response_coarse: 0.4
    loop_match_minimum_response_fine: 0.5

    # Fine-tuning Scan Matcher (Defaults/User-provided often okay)
    fine_search_angle_offset: 0.00349
    coarse_search_angle_offset: 0.349
    coarse_angle_resolution: 0.0349
    minimum_angle_penalty: 0.9
    minimum_distance_penalty: 0.5
    use_response_expansion: true
    min_pass_through: 2    